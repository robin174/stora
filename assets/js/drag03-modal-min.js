console.log("API URL being used:",wpData.api_url),document.addEventListener("DOMContentLoaded",(async function(){const e=document.getElementById("cardModal"),t=new bootstrap.Modal(e,{backdrop:"static"});let o=null,r=[];function n(){let e=0,t=0,o=0,r=0;document.querySelectorAll(".card").forEach((n=>{let a=parseFloat(n.querySelector(".card-cost").textContent.replace("Total Cost: $",""))||0,d=n.dataset.type;if(n.closest(".cloud-costs-column"))r+=a;else switch(d){case"Cloud":e+=a;break;case"Decentralized":t+=a;break;case"On Prem":o+=a}}));const n=e+t+o,a=r-n;document.getElementById("total-cloud-cost").textContent=`$${e.toFixed(2)}`,document.getElementById("total-decentralized-cost").textContent=`$${t.toFixed(2)}`,document.getElementById("total-onprem-cost").textContent=`$${o.toFixed(2)}`,document.getElementById("total-current-cloud-cost").textContent=`$${r.toFixed(2)}`,document.getElementById("total-new-cost").textContent=`$${n.toFixed(2)}`;const d=document.getElementById("cost-difference");d.textContent=`$${Math.abs(a).toFixed(2)}`,d.style.color=a>0?"green":"red"}function a(){let e=0;if("On Prem"===o.dataset.type){const t=parseFloat(document.getElementById("costPerServer").value)||0,r=parseInt(document.getElementById("numberOfServers").value,10)||0;e=t*r,o&&(o.querySelector(".card-text").textContent=`Number of Servers: ${r} @ $${t}/server`)}else{const t=document.getElementById("cardProvider"),r=t.options[t.selectedIndex],n=r.dataset.price?parseFloat(r.dataset.price):0,a=parseInt(document.getElementById("cardNumber").value,10)||0;e=a*n,o&&(o.querySelector(".card-text").textContent=`Number: ${a} TB`)}document.getElementById("calculatedCost").textContent=`Total Cost: $${e.toFixed(2)}`}console.log("Fetching from API URL:",wpData.api_url),document.querySelectorAll(".card").forEach((e=>{e.closest(".cloud-costs-column")||(e.setAttribute("draggable",!0),e.addEventListener("dragstart",(function(t){t.dataTransfer.setData("text/plain",e.dataset.cardId),t.dataTransfer.effectAllowed="move"})),e.addEventListener("DOMSubtreeModified",n))})),document.querySelectorAll(".row[data-row] .col[data-column]").forEach((e=>{e.addEventListener("dragover",(e=>e.preventDefault())),e.addEventListener("drop",(function(t){t.preventDefault();const o=t.dataTransfer.getData("text/plain"),r=document.querySelector(`[data-card-id="${o}"]`);if(!r)return;r.closest(".row[data-row]")===e.closest(".row[data-row]")?(e.appendChild(r),function(e,t){const o={1:"Cloud",2:"Decentralized",3:"On Prem"}[t]||"Unknown";e.dataset.type=o,"On Prem"===o?document.querySelectorAll(".onprem-fields").forEach((e=>e.style.display="block")):document.querySelectorAll(".onprem-fields").forEach((e=>e.style.display="none"))}(r,e.dataset.column),n()):console.log("Cards can only be moved left/right within the same row.")}))})),document.querySelectorAll(".btn-edit-card").forEach((e=>{e.addEventListener("click",(function(){console.log("Opening modal..."),o=this.closest(".card");const e=o.querySelector(".card-title").textContent;document.getElementById("cardTitle").value=e;const n=o.dataset.type;if("On Prem"===n){document.querySelectorAll(".onprem-fields").forEach((e=>e.style.display="block")),document.querySelectorAll(".storage-fields").forEach((e=>e.style.display="none"));const e=o.dataset.costPerServer?parseFloat(o.dataset.costPerServer):0,t=o.dataset.numberOfServers?parseInt(o.dataset.numberOfServers,10):0;document.getElementById("costPerServer").value=e,document.getElementById("numberOfServers").value=t}else{document.querySelectorAll(".onprem-fields").forEach((e=>e.style.display="none")),document.querySelectorAll(".storage-fields").forEach((e=>e.style.display="block"));const e=o.dataset.cardNumber?o.dataset.cardNumber:o.querySelector(".card-text").textContent.replace("Number: ","").replace(" TB","").trim();document.getElementById("cardNumber").value=e;!function(e,t=null){console.log("Populating providers for:",e);const o=document.getElementById("cardProvider");o.innerHTML="<option disabled selected>Loading...</option>";const n=r.filter((t=>t.type===e));setTimeout((()=>{o.innerHTML='<option value="0">- Please select</option>',n.forEach((e=>{const r=document.createElement("option");r.value=e.provider,r.dataset.price=e.price,r.textContent=`${e.provider} - $${e.price} / TB`,t&&e.provider===t&&(r.selected=!0),o.appendChild(r)})),a()}),1e3)}(n,o.querySelector(".card-provider").textContent.replace("Provider: ","").trim())}a(),t.show()}))})),document.getElementById("cardProvider").addEventListener("change",a),document.getElementById("cardNumber").addEventListener("input",a),document.getElementById("costPerServer").addEventListener("input",a),document.getElementById("numberOfServers").addEventListener("input",a),document.getElementById("saveCardButton").addEventListener("click",(function(){if(!o)return;const e=document.getElementById("cardTitle").value;let r=parseFloat(document.getElementById("calculatedCost").textContent.replace("Total Cost: $",""))||0;if(o.querySelector(".card-title").textContent=e,"On Prem"===o.dataset.type){const e=parseFloat(document.getElementById("costPerServer").value)||0,t=parseInt(document.getElementById("numberOfServers").value,10)||0;o.dataset.costPerServer=e,o.dataset.numberOfServers=t,o.querySelector(".card-text").textContent=`Number of Servers: ${t} @ $${e}/server`}else{const e=document.getElementById("cardNumber").value;o.dataset.cardNumber=e,o.querySelector(".card-text").textContent=`Number: ${e} TB`;const t=document.getElementById("cardProvider").value;o.querySelector(".card-provider").textContent=`Provider: ${t}`}o.querySelector(".card-cost").textContent=`Total Cost: $${r.toFixed(2)}`,n(),t.hide()})),await async function(){try{const e=await fetch(wpData.api_url);if(!e.ok)throw new Error("Failed to fetch data from API");r=await e.json(),console.log("Fetched Airtable Data:",r)}catch(e){console.error(e.message)}}()}));