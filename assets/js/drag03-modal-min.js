console.log("API URL being used:",wpData.api_url),document.addEventListener("DOMContentLoaded",(async function(){const e=document.getElementById("cardModal"),t=new bootstrap.Modal(e,{backdrop:"static"});let n=null,o=[];function r(){let e=0,t=0,n=0,o=0;document.querySelectorAll(".card").forEach((r=>{let d=parseFloat(r.querySelector(".card-cost").textContent.replace("Total Cost: $",""))||0,a=r.dataset.type;if(r.closest(".cloud-costs-column"))o+=d;else switch(a){case"Cloud":e+=d;break;case"Decentralized":t+=d;break;case"On Prem":n+=d}}));const r=e+t+n,d=o-r;document.getElementById("total-cloud-cost").textContent=`$${e.toFixed(2)}`,document.getElementById("total-decentralized-cost").textContent=`$${t.toFixed(2)}`,document.getElementById("total-onprem-cost").textContent=`$${n.toFixed(2)}`,document.getElementById("total-current-cloud-cost").textContent=`$${o.toFixed(2)}`,document.getElementById("total-new-cost").textContent=`$${r.toFixed(2)}`;const a=document.getElementById("cost-difference");a.textContent=`$${Math.abs(d).toFixed(2)}`,a.style.color=d>0?"green":"red"}function d(){const e=document.getElementById("cardProvider"),t=e.options[e.selectedIndex],o=t.dataset.price?parseFloat(t.dataset.price):0;let r=(parseInt(document.getElementById("cardNumber").value,10)||0)*o;if(n&&"On Prem"===n.dataset.type){r=(parseFloat(document.getElementById("costPerServer").value)||0)*(parseInt(document.getElementById("numberOfServers").value,10)||0)}document.getElementById("calculatedCost").textContent=`Total Cost: $${r.toFixed(2)}`}console.log("Fetching from API URL:",wpData.api_url),document.querySelectorAll(".card").forEach((e=>{e.closest(".cloud-costs-column")||(e.setAttribute("draggable",!0),e.addEventListener("dragstart",(function(t){t.dataTransfer.setData("text/plain",e.dataset.cardId),t.dataTransfer.effectAllowed="move"})),e.addEventListener("DOMSubtreeModified",r))})),document.querySelectorAll(".row[data-row] .col[data-column]").forEach((e=>{e.addEventListener("dragover",(e=>e.preventDefault())),e.addEventListener("drop",(function(t){t.preventDefault();const n=t.dataTransfer.getData("text/plain"),o=document.querySelector(`[data-card-id="${n}"]`);o&&(e.appendChild(o),function(e,t){const n={1:"Cloud",2:"Decentralized",3:"On Prem"}[t]||"Unknown";e.dataset.type=n,"On Prem"===n?document.querySelectorAll(".onprem-fields").forEach((e=>e.style.display="block")):document.querySelectorAll(".onprem-fields").forEach((e=>e.style.display="none"))}(o,e.dataset.column),r())}))})),document.querySelectorAll(".btn-edit-card").forEach((e=>{e.addEventListener("click",(function(){n=this.closest(".card");const e=n.querySelector(".card-title").textContent,r=n.querySelector(".card-text").textContent.replace("Number: ",""),a=n.querySelector(".card-provider").textContent.replace("Provider: ",""),c=n.dataset.type;document.getElementById("cardTitle").value=e,document.getElementById("cardNumber").value=r,document.getElementById("cardProvider").innerHTML='<option value="0">Loading...</option>',function(e,t=null){const n=document.getElementById("cardProvider");n.innerHTML='<option value="0">- Please select</option>';const r=o.filter((t=>t.type===e));r.forEach((e=>{const o=document.createElement("option");o.value=e.provider,o.dataset.price=e.price,o.textContent=`${e.provider} - $${e.price} / TB`,t&&e.provider===t&&(o.selected=!0),n.appendChild(o)})),d()}(c,a),d();const l="On Prem"===c;document.querySelectorAll(".onprem-fields").forEach((e=>e.style.display=l?"block":"none")),t.show()}))})),document.getElementById("cardProvider").addEventListener("change",d),document.getElementById("cardNumber").addEventListener("input",d),document.getElementById("costPerServer").addEventListener("input",d),document.getElementById("numberOfServers").addEventListener("input",d),document.getElementById("saveCardButton").addEventListener("click",(function(){if(!n)return;const e=document.getElementById("cardTitle").value,o=document.getElementById("cardProvider").value;let d=parseFloat(document.getElementById("calculatedCost").textContent.replace("Total Cost: $",""))||0;n.querySelector(".card-title").textContent=e,n.querySelector(".card-provider").textContent=`Provider: ${o}`,n.querySelector(".card-cost").textContent=`Total Cost: $${d.toFixed(2)}`,r(),t.hide()})),await async function(){try{const e=await fetch(wpData.api_url);if(!e.ok)throw new Error("Failed to fetch data from API");o=await e.json(),console.log("Fetched Airtable Data:",o)}catch(e){console.error(e.message)}}()}));